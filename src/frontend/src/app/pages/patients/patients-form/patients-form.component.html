<div class="p-6 max-w-2xl mx-auto">
  <div class="flex items-center gap-4 mb-6">
    <a
      routerLink="/pacientes"
      class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"
    >
      <lucide-icon [img]="ArrowLeft" class="w-5 h-5"></lucide-icon>
    </a>
    <h1 class="text-2xl font-bold text-gray-800">
      {{ isEditing() ? 'Editar Paciente' : 'Nuevo Paciente' }}
    </h1>
  </div>

  @if (error()) {
    <div class="bg-red-100 text-red-700 px-4 py-3 rounded-lg mb-4">
      {{ error() }}
    </div>
  }

  <div class="bg-white rounded-xl shadow p-6">
    <form [formGroup]="form" (ngSubmit)="save()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Nombre <span class="text-red-500">*</span>
          </label>
          <input
            formControlName="nombre"
            type="text"
            placeholder="Ej: Juan"
            class="w-full border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition"
            [class.border-red-400]="isFieldInvalid('nombre')"
            [class.border-gray-300]="!isFieldInvalid('nombre')"
          />
          @if (isFieldInvalid('nombre')) {
            <p class="text-red-500 text-xs mt-1">El nombre es obligatorio</p>
          }
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Apellido <span class="text-red-500">*</span>
          </label>
          <input
            formControlName="apellido"
            type="text"
            placeholder="Ej: Pérez"
            class="w-full border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition"
            [class.border-red-400]="isFieldInvalid('apellido')"
            [class.border-gray-300]="isFieldInvalid('apellido')"
          />
          @if (isFieldInvalid('apellido')) {
            <p class="text-red-500 text-xs mt-1">El apellido es obligatorio</p>
          }
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Fecha de Nacimiento <span class="text-red-500">*</span>
        </label>
        <input
          formControlName="fechaNacimiento"
          type="date"
          class="w-full border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition"
          [class.border-red-400]="isFieldInvalid('fechaNacimiento')"
          [class.border-gray-300]="!isFieldInvalid('fechaNacimiento')"
        />
        @if (isFieldInvalid('fechaNacimiento')) {
          <p class="text-red-500 text-xs mt-1">La fecha de nacimiento es obligatoria</p>
        }
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Cédula</label>
          <input
            formControlName="cedula"
            type="text"
            placeholder="Ej: 1234567890"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
          <input
            formControlName="telefono"
            type="text"
            placeholder="Ej: 0991234567"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition"
          />
        </div>
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-1">Dirección</label>
        <textarea
          formControlName="direccion"
          rows="3"
          placeholder="Ej: Av. Principal 123"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-500 transition resize-none"
        >
        </textarea>
      </div>

      <div class="flex justify-end gap-3">
        <a
          routerLink="/pacientes"
          class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition text-sm"
        >
          Cancelar
        </a>
        <button
          type="submit"
          [disabled]="loading()"
          class="flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition text-sm disabled:opacity-50 disabled:cursor-not-allowed"
        >
          @if (loading()) {
            <lucide-icon [img]="Loader" class="w-4 h-4 animate-spin"></lucide-icon>
            Guardando...
          } @else {
            <lucide-icon [img]="Save" class="w-4 h-4"></lucide-icon>
            {{ isEditing() ? 'Actualizar' : 'Guardar' }}
          }
        </button>
      </div>
    </form>
  </div>
</div>
